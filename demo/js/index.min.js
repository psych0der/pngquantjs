!function(){var e,t=null;window.$=document.querySelector.bind(document);var n=null;function a(e,t){var n=t?1e3:1024;if(Math.abs(e)<n)return e+" B";var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=-1;do{e/=n,++i}while(Math.abs(e)>=n&&i<a.length-1);return e.toFixed(1)+" "+a[i]}var i=function(e){var t=new FileReader;t.onload=function(t){$("#input-img").setAttribute("src",t.target.result),$("#input-file-stats").innerHTML="Input image ["+a(e.size)+"]",$("#terminal").style.display="block",$("#file-dropper").style.display="none",((e,t)=>{const n=document.createElement("canvas"),a=n.getContext("2d");a||t(e);const i=new Image;i.onload=(()=>{const e=i.naturalWidth,r=i.naturalHeight;n.width=e,n.height=r,a.drawImage(i,0,0),t(n.toDataURL("image/png"))}),i.src=e})(t.target.result,e=>{n=function(e){for(var t=e.split(","),n=(t[0].match(/:(.*?);/)[1],atob(t[1])),a=n.length,i=new Uint8Array(a);a--;)i[a]=n.charCodeAt(a);return i}(e)})},t.readAsDataURL(e)};function r(){var e=$(".range-slider").getElementsByTagName("input"),t=parseFloat(e[0].value),n=parseFloat(e[1].value);if(t>n){var a=n;n=t,t=a}return $(".range-values").innerHTML=t+" - "+n,t+"-"+n}function l(){var e=$("#speed-control");return $(".speed-value").innerHTML=e.value,e.value}function s(){(e=new Worker("js/worker.js")).onmessage=function(e){var n=e.data;if("ready"==n.type)$(".loading").style.display="none",$(".loaded").style.display="block",$("#compress").disabled=!1,$("#reset").disabled=!1;else if("stdout"==n.type)t.textContent+=n.data+"\n";else if("start"==n.type)t.textContent="Worker has received command\n";else if("done"==n.type){var i=n.data;i&&i.length&&(t.className="closed"),i&&i.forEach(function(e){$("#output-img").src=function(e,t){if(t.match(/\.jpeg|\.gif|\.jpg|\.png/)){var n=new Blob([e]);return window.URL.createObjectURL(n)}}(e.data,"output.png"),$("#output-file-stats").innerHTML="Output image ["+a(e.data.byteLength)+"]",$(".output-preview").style.display="block",$(".compress-text").style.display="none",$(".refresh-container").style.display="block"})}}}document.addEventListener("DOMContentLoaded",function(){t=$("#output"),s(),$("#filePicker").onchange=function(e){if(this.files&&this.files[0]){if(!this.files[0].name.match(/.(png)$/i))return void alert("not a valid PNG image");i(this.files[0])}},$("#file-dropper").ondragover=function(){return this.className="hover",!1},$("#file-dropper").ondragend=function(){return this.className="",!1},$("#file-dropper").ondrop=function(e){this.className="",e.preventDefault();var t=e.dataTransfer.files[0];i(t)};var a=$(".range-slider");Array.isArray(a)||(a=[a]);for(var o=0;o<a.length;o++)for(var u=a[o].getElementsByTagName("input"),p=0;p<u.length;p++)"range"===u[p].type&&(u[p].oninput=r,u[p].oninput());$("#speed-control").oninput=l,$("#speed-control").oninput(),$("#compress").onclick=function(t){var a;t.preventDefault(),$("#console").style.display="block",$(".compress-text").style.display="block",$("#control-panel").style.display="none",a={quality:r(),speed:""+l()},e.postMessage({type:"command",arguments:a,file:{name:"input.png",data:n}})},$("#reset").onclick=function(e){e.preventDefault(),$("#input-img").setAttribute("src",""),$("#input-file-stats").innerHTML="",$("#terminal").style.display="none",$("#file-dropper").style.display="block",n=null},$("#refresh").onclick=function(e){e.preventDefault(),$("#output-img").src="",$("#output-file-stats").innerHTML="",$(".output-preview").style.display="none",$("#output").innerHTML="",$("#console").style.display="none",$("#input-img").setAttribute("src",""),$("#input-file-stats").innerHTML="",$("#terminal").style.display="none",$("#file-dropper").style.display="block",$(".refresh-container").style.display="none",$("#control-panel").style.display="block",n=null}})}();
